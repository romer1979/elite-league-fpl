<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Libya FPL</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Cities League specific overrides */
        
        /* Week Highlights - Team & Star of the Week */
        .week-highlights {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .highlight-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid var(--border-color);
            flex: 1;
            min-width: 200px;
        }
        
        .highlight-card.team-of-week {
            border-color: rgba(245, 200, 66, 0.3);
            background: linear-gradient(135deg, rgba(245, 200, 66, 0.1), transparent);
        }
        
        .highlight-card.star-of-week {
            border-color: rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), transparent);
        }
        
        .highlight-icon {
            font-size: 2rem;
        }
        
        .highlight-content {
            display: flex;
            flex-direction: column;
        }
        
        .highlight-label {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 0.1rem;
        }
        
        .highlight-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-purple);
        }
        
        .highlight-points {
            font-size: 0.85rem;
            color: #28a745;
            font-weight: 600;
        }
        
        .highlight-team {
            font-size: 0.75rem;
            color: #f5c842;
            font-weight: 500;
        }
        
        .highlight-card.update-info {
            flex: 0 0 auto;
            min-width: 150px;
        }
        
        .highlight-card.update-info .highlight-name {
            font-size: 1rem;
        }
        
        /* Rank change arrows */
        .rank-up {
            color: #22c55e;
            font-weight: 700;
            font-size: 0.8rem;
        }
        
        .rank-down {
            color: #ef4444;
            font-weight: 700;
            font-size: 0.8rem;
        }
        
        .rank-same {
            color: #888;
            font-size: 0.8rem;
        }
        
        .rank-change-cell {
            text-align: center;
            min-width: 50px;
        }
        
        /* League points highlight - bold and purple */
        .league-points-cell {
            color: var(--primary-purple);
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .ms-lp {
            color: var(--primary-purple);
            font-weight: 700;
        }
        
        /* Row highlighting for win/loss */
        .row-win {
            background: rgba(34, 197, 94, 0.08) !important;
        }
        
        .row-loss {
            background: rgba(239, 68, 68, 0.08) !important;
        }
        
        /* Unique player status colors - Simple: blue, grey, purple */
        .unique-player-tag.status-playing,
        .unique-tag.status-playing {
            background: #007bff !important;
            color: white !important;
        }
        
        .unique-player-tag.status-played,
        .unique-tag.status-played {
            background: #6c757d !important;
            color: #e0e0e0 !important;
        }
        
        .unique-player-tag.status-pending,
        .unique-tag.status-pending {
            background: var(--primary-purple) !important;
            color: white !important;
        }
        
        /* Stacked captains in standings */
        .captains-stacked-cell {
            font-size: 0.7rem;
            color: #f5c842;
            text-align: right;
            padding: 0.25rem 0.5rem !important;
            max-width: 100px;
        }
        
        .captain-row {
            white-space: nowrap;
            line-height: 1.4;
        }
        
        .captains-col-header {
            max-width: 100px;
        }
        
        /* Mobile standings change column */
        .msh-change, .ms-change {
            width: 40px;
            text-align: center;
        }
        
        /* Mobile standing details */
        .mobile-standing-details {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.02);
            border-top: 1px solid var(--border-color);
        }
        
        .ms-detail {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
        }
        
        .ms-label {
            color: #888;
            font-size: 0.8rem;
        }
        
        .ms-value {
            font-size: 0.8rem;
        }
        
        .captains-value {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.1rem;
        }
        
        .mobile-captain {
            color: #f5c842;
            font-size: 0.75rem;
        }
        
        .mobile-standing-row {
            cursor: pointer;
        }
        
        /* Mobile adjustments */
        @media (max-width: 768px) {
            .captains-stacked-cell, .captains-col-header {
                display: none;
            }
            
            .week-highlights {
                flex-direction: column;
            }
            
            .highlight-card {
                min-width: 100%;
            }
            
            .highlight-card.update-info {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <img src="{{ url_for('static', filename='arab_logo.png') }}" alt="Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" class="logo-img">
                <div class="logo-text">
                    <span class="logo-title">Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                    <span class="logo-subtitle">ARAB CHAMPIONSHIP</span>
                </div>
            </a>
            <div class="gameweek-info">
                <span class="gw-label">Ø§Ù„Ø¬ÙˆÙ„Ø©</span>
                <span class="gw-number">{{ data.gameweek or '-' }}</span>
                {% if data.is_live %}
                    <span class="status-badge live">ğŸ”´ Ù…Ø¨Ø§Ø´Ø±</span>
                {% elif data.gw_finished %}
                    <span class="status-badge finished">âœ… Ø§Ù†ØªÙ‡Øª</span>
                {% else %}
                    <span class="status-badge not-started">â³ Ù„Ù… ØªØ¨Ø¯Ø£</span>
                {% endif %}
                <button class="refresh-btn" onclick="location.reload()">ğŸ”„</button>
                <a href="/" class="stats-link">ğŸ </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Team & Star of the Week -->
        <div class="week-highlights">
            <div class="highlight-card team-of-week">
                <div class="highlight-icon">ğŸ†</div>
                <div class="highlight-content">
                    <span class="highlight-label">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¬ÙˆÙ„Ø©</span>
                    <span class="highlight-name">{{ data.best_team.name or '-' }}</span>
                    <span class="highlight-points">{{ data.best_team.points or 0 }} Ù†Ù‚Ø·Ø©</span>
                </div>
            </div>
            <div class="highlight-card star-of-week">
                <div class="highlight-icon">â­</div>
                <div class="highlight-content">
                    <span class="highlight-label">Ù†Ø¬Ù… Ø§Ù„Ø¬ÙˆÙ„Ø©</span>
                    <span class="highlight-name">{{ data.best_manager.name or '-' }}</span>
                    <span class="highlight-team">{{ data.best_manager.team or '' }}</span>
                    <span class="highlight-points">{{ data.best_manager.points or 0 }} Ù†Ù‚Ø·Ø©</span>
                </div>
            </div>
            <div class="highlight-card update-info">
                <div class="highlight-icon">ğŸ•</div>
                <div class="highlight-content">
                    <span class="highlight-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</span>
                    <span class="highlight-name" id="last-updated-time" data-utc="{{ data.last_updated_utc or '' }}">-</span>
                </div>
            </div>
        </div>

        <script>
            // Convert UTC time to user's local timezone
            (function() {
                const el = document.getElementById('last-updated-time');
                const utcTime = el.getAttribute('data-utc');
                if (utcTime) {
                    const date = new Date(utcTime);
                    const options = {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    };
                    el.textContent = date.toLocaleString('en-GB', options).replace(',', ' -');
                }
            })();
        </script>

        <div class="dashboard-grid">
            <!-- Fixtures Section (Right side in RTL) -->
            <section class="fixtures-section">
                <h2 class="section-title">
                    âš”ï¸ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø¬ÙˆÙ„Ø©
                </h2>
                
                {% if data.matches %}
                    <!-- Desktop Table View -->
                    <div class="fixtures-table-container desktop-only">
                        <table class="fixtures-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</th>
                                    <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                                    <th>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</th>
                                    <th>Ø§Ù„ÙØ§Ø±Ù‚</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for match in data.matches %}
                                <tr class="fixture-row">
                                    <td class="team-cell {% if match.winner == 1 %}winner{% endif %}">
                                        <div class="team-info-cell">
                                            <span class="team-name">
                                                {% if match.winner == 1 %}<span class="winner-icon">âœ“</span>{% endif %}
                                                {{ match.team_1 }}
                                            </span>
                                            <span class="team-details">
                                                <span class="captain-badge" title="Ø§Ù„ÙƒØ¨Ø§ØªÙ†">ğŸ‘‘ {{ match.captains_1|join(' â€¢ ') }}</span>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="score-cell">
                                        <span class="score {% if match.winner == 1 %}score-win{% endif %}">{{ match.points_1 }}</span>
                                        <span class="vs">-</span>
                                        <span class="score {% if match.winner == 2 %}score-win{% endif %}">{{ match.points_2 }}</span>
                                    </td>
                                    <td class="team-cell {% if match.winner == 2 %}winner{% endif %}">
                                        <div class="team-info-cell">
                                            <span class="team-name">
                                                {% if match.winner == 2 %}<span class="winner-icon">âœ“</span>{% endif %}
                                                {{ match.team_2 }}
                                            </span>
                                            <span class="team-details">
                                                <span class="captain-badge" title="Ø§Ù„ÙƒØ¨Ø§ØªÙ†">ğŸ‘‘ {{ match.captains_2|join(' â€¢ ') }}</span>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="diff-cell">
                                        <span class="diff-badge">{{ match.points_diff }}</span>
                                        <button class="toggle-unique-btn" onclick="toggleUnique({{ loop.index }})">â–¼</button>
                                    </td>
                                </tr>
                                <tr class="unique-players-row" id="unique-row-{{ loop.index }}" style="display: none;">
                                    <td colspan="4">
                                        <div class="unique-players-container">
                                            <div class="unique-team unique-team-1">
                                                <span class="unique-label">{{ match.team_1 }}:</span>
                                                <div class="unique-players-list">
                                                    {% for player in match.team_1_unique %}
                                                        <span class="unique-player-tag status-{{ player.status }}">{{ player.name }}</span>
                                                    {% else %}
                                                        <span class="no-unique">-</span>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="unique-team unique-team-2">
                                                <span class="unique-label">{{ match.team_2 }}:</span>
                                                <div class="unique-players-list">
                                                    {% for player in match.team_2_unique %}
                                                        <span class="unique-player-tag status-{{ player.status }}">{{ player.name }}</span>
                                                    {% else %}
                                                        <span class="no-unique">-</span>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Mobile Cards View -->
                    <div class="mobile-fixtures mobile-only">
                        {% for match in data.matches %}
                        <div class="fixture-card" onclick="toggleMobileUnique({{ loop.index }})">
                            <div class="fixture-card-main">
                                <!-- Team 1 -->
                                <div class="fixture-team {% if match.winner == 1 %}winner{% endif %}">
                                    <span class="fixture-team-name">
                                        {% if match.winner == 1 %}âœ“ {% endif %}{{ match.team_1 }}
                                    </span>
                                    <div class="fixture-team-details">
                                        <span class="fixture-captain">ğŸ‘‘ {{ match.captains_1|join(' â€¢ ') }}</span>
                                    </div>
                                </div>
                                
                                <!-- Score -->
                                <div class="fixture-score-block">
                                    <div class="fixture-scores">
                                        <span class="fixture-pts {% if match.winner == 1 %}winning{% endif %}">{{ match.points_1 }}</span>
                                        <span class="fixture-separator">-</span>
                                        <span class="fixture-pts {% if match.winner == 2 %}winning{% endif %}">{{ match.points_2 }}</span>
                                    </div>
                                    <div class="fixture-diff">
                                        <span class="fixture-diff-badge {% if match.winner == 1 %}diff-left{% elif match.winner == 2 %}diff-right{% endif %}">
                                            {% if match.winner == 1 %}â—€{% elif match.winner == 2 %}â–¶{% endif %} {{ match.points_diff }}
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Team 2 -->
                                <div class="fixture-team {% if match.winner == 2 %}winner{% endif %}">
                                    <span class="fixture-team-name">
                                        {% if match.winner == 2 %}âœ“ {% endif %}{{ match.team_2 }}
                                    </span>
                                    <div class="fixture-team-details">
                                        <span class="fixture-captain">ğŸ‘‘ {{ match.captains_2|join(' â€¢ ') }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Unique Players (Hidden by default) -->
                            <div class="fixture-card-unique" id="mobile-unique-{{ loop.index }}" style="display: none;">
                                <div class="unique-section">
                                    <div class="unique-header">{{ match.team_1 }}</div>
                                    <div class="unique-players">
                                        {% for player in match.team_1_unique %}
                                            <span class="unique-tag status-{{ player.status }}">{{ player.name }}</span>
                                        {% else %}
                                            <span class="unique-none">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="unique-section">
                                    <div class="unique-header">{{ match.team_2 }}</div>
                                    <div class="unique-players">
                                        {% for player in match.team_2_unique %}
                                            <span class="unique-tag status-{{ player.status }}">{{ player.name }}</span>
                                        {% else %}
                                            <span class="unique-none">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="fixture-card-expand">
                                <span class="expand-hint" id="expand-hint-{{ loop.index }}">â–¼ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª</div>
                {% endif %}
            </section>

            <!-- Standings Section (Left side in RTL) -->
            <section class="standings-section">
                <h2 class="section-title">
                    ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙˆØ±ÙŠ
                </h2>
                
                {% if data.standings %}
                    <!-- Desktop Table -->
                    <div class="standings-table-container desktop-only">
                        <table class="standings-table">
                            <thead>
                                <tr>
                                    <th>Ù…</th>
                                    <th>Ø§Ù„ÙØ±ÙŠÙ‚</th>
                                    <th>Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø©</th>
                                    <th>Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯ÙˆØ±ÙŠ</th>
                                    <th>+/-</th>
                                    <th class="captains-col-header">Ø§Ù„ÙƒØ¨Ø§ØªÙ†</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for team in data.standings %}
                                <tr class="{% if loop.index <= 3 %}top-three{% endif %} {% if team.result == 'W' %}row-win{% elif team.result == 'L' %}row-loss{% endif %}">
                                    <td class="rank-cell">
                                        {% if loop.index == 1 %}
                                            <span class="rank-badge gold">ğŸ¥‡</span>
                                        {% elif loop.index == 2 %}
                                            <span class="rank-badge silver">ğŸ¥ˆ</span>
                                        {% elif loop.index == 3 %}
                                            <span class="rank-badge bronze">ğŸ¥‰</span>
                                        {% else %}
                                            {{ team.rank }}
                                        {% endif %}
                                    </td>
                                    <td class="name-cell">{{ team.team_name }}</td>
                                    <td class="gw-points-cell">{{ team.live_gw_points }}</td>
                                    <td class="league-points-cell">{{ team.league_points }}</td>
                                    <td class="rank-change-cell">
                                        {% if team.rank_change and team.rank_change > 0 %}
                                            <span class="rank-up">â–²{{ team.rank_change }}</span>
                                        {% elif team.rank_change and team.rank_change < 0 %}
                                            <span class="rank-down">â–¼{{ team.rank_change|abs }}</span>
                                        {% else %}
                                            <span class="rank-same">-</span>
                                        {% endif %}
                                    </td>
                                    <td class="captains-stacked-cell">
                                        {% for cap in team.captains %}
                                            <div class="captain-row">ğŸ‘‘ {{ cap }}</div>
                                        {% endfor %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Mobile Standings -->
                    <div class="mobile-standings mobile-only">
                        <div class="mobile-standings-header">
                            <span class="msh-rank">Ù…</span>
                            <span class="msh-name">Ø§Ù„ÙØ±ÙŠÙ‚</span>
                            <span class="msh-gw">Ù†.Ø¬</span>
                            <span class="msh-lp">Ù†.Ø¯</span>
                            <span class="msh-change">+/-</span>
                        </div>
                        {% for team in data.standings %}
                        <div class="mobile-standing-row {% if loop.index <= 3 %}top-three{% endif %} {% if team.result == 'W' %}row-win{% elif team.result == 'L' %}row-loss{% endif %}" onclick="toggleStandingDetails({{ loop.index }})">
                            <div class="mobile-standing-main">
                                <span class="ms-rank">
                                    {% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif loop.index == 3 %}ğŸ¥‰{% else %}{{ team.rank }}{% endif %}
                                </span>
                                <span class="ms-name">{{ team.team_name }}</span>
                                <span class="ms-gw">{{ team.live_gw_points }}</span>
                                <span class="ms-lp">{{ team.league_points }}</span>
                                <span class="ms-change">
                                    {% if team.rank_change and team.rank_change > 0 %}
                                        <span class="rank-up">â–²{{ team.rank_change }}</span>
                                    {% elif team.rank_change and team.rank_change < 0 %}
                                        <span class="rank-down">â–¼{{ team.rank_change|abs }}</span>
                                    {% else %}
                                        <span class="rank-same">-</span>
                                    {% endif %}
                                </span>
                            </div>
                            <div class="mobile-standing-details" id="standing-details-{{ loop.index }}" style="display: none;">
                                <div class="ms-detail">
                                    <span class="ms-label">Ø§Ù„ÙƒØ¨Ø§ØªÙ†:</span>
                                    <span class="ms-value captains-value">
                                        {% for cap in team.captains %}
                                            <span class="mobile-captain">ğŸ‘‘ {{ cap }}</span>
                                        {% endfor %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="no-data">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                {% endif %}
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer style="text-align: center; padding: 2rem; color: #888; font-size: 0.8rem;">
        <p>Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø¨Ø·ÙˆÙ„Ø© Ø¹Ø´Ø§Ù‚ Ø§Ù„ÙØ§Ù†ØªØ§Ø²ÙŠ ÙÙŠ Ø§Ù„ÙˆØ·Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ</p>
        <p style="margin-top: 0.25rem; color: #666;">ÙƒÙ„ ÙØ±ÙŠÙ‚ ÙŠØªÙƒÙˆÙ† Ù…Ù† 3 Ù…Ø¯ÙŠØ±ÙŠÙ†</p>
    </footer>

    <script>
        // Toggle unique players row (desktop)
        function toggleUnique(index) {
            const row = document.getElementById('unique-row-' + index);
            if (row) {
                row.style.display = row.style.display === 'none' ? 'table-row' : 'none';
            }
        }
        
        // Toggle unique players (mobile)
        function toggleMobileUnique(index) {
            const uniqueDiv = document.getElementById('mobile-unique-' + index);
            const hint = document.getElementById('expand-hint-' + index);
            if (uniqueDiv) {
                const isHidden = uniqueDiv.style.display === 'none';
                uniqueDiv.style.display = isHidden ? 'block' : 'none';
                if (hint) {
                    hint.textContent = isHidden ? 'â–² Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†' : 'â–¼ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†';
                }
            }
        }
        
        // Toggle standing details (mobile)
        function toggleStandingDetails(index) {
            const details = document.getElementById('standing-details-' + index);
            if (details) {
                details.style.display = details.style.display === 'none' ? 'block' : 'none';
            }
        }
    </script>
</body>
</html>
